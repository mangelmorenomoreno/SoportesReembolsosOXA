<mvc:View
  controllerName="co.com.conconcreto.soportereembolsos.controller.Reembolsos"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:f="sap.f"
  xmlns:core="sap.ui.core"
  xmlns:vm="sap.ui.comp.variants">

  <!--
    Ajuste solicitado:
    - Se elimina el botón "Cargar detalle"
    - El PDF se genera directamente con los registros SELECCIONADOS en la tabla
    - Se simplifica a una sola tabla (lista) para selección + generación PDF
  -->

  <f:DynamicPage id="dpReembolsos" showFooter="false">

    <!-- =========================
         TITLE (con VariantManagement)
         ========================= -->
    <f:title>
      <f:DynamicPageTitle id="idDynamicPageTitle">

        <f:heading>
          <!-- Si tu controller NO tiene estos métodos (onVariantManagementSelect/Save/Manage),
               quita los eventos o copia la implementación del controller ejemplo. -->
          <vm:VariantManagement
            id="idVariantManagement"
            select=".onVariantManagementSelect"
            save=".onVariantManagementSave"
            manage=".onVariantManagementManage"
            selectedKey="Standard"
            defaultKey="Standard"
            popoverTitle="my Favorites">

            <vm:items>
              <vm:VariantItem
                id="idVariantItemStandard"
                key="Standard"
                title="Standard"
                author="SAP"
                rename="false"
                sharing="Public" />
            </vm:items>

          </vm:VariantManagement>
        </f:heading>

        <!-- Estado (snapped) -->
        <f:snappedContent>
          <ObjectStatus
            id="osEstadoFiltros"
            text="{= ${/ui/sociedadSelected} ? 'Filtros activos' : 'Seleccione una sociedad para iniciar' }"
            state="{= ${/ui/sociedadSelected} ? 'Success' : 'None' }" />
        </f:snappedContent>

      </f:DynamicPageTitle>
    </f:title>

    <!-- =========================
         HEADER (filtros estilo HBox/VBox)
         ========================= -->
    <f:header>
      <f:DynamicPageHeader id="idDynamicPageHeader" pinnable="true">
        <f:content>

          <HBox
            id="hbFiltros"
            wrap="Wrap"
            alignItems="Center"
            class="sapUiSmallMargin">

            <!-- SOCIEDAD -->
            <VBox id="vbSociedad" class="sapUiTinyMarginEnd">
              <Label id="lblSociedad" text="Sociedad" required="true" labelFor="inpSociedad" />
              <Input
                id="inpSociedad"
                value="{/filters/Sociedad}"
                placeholder="Selecciona sociedad"
                width="200px"
                showValueHelp="true"
                valueHelpRequest=".onValueHelpSociedad" />
            </VBox>

            <!-- PROYECTO -->
            <VBox id="vbProyecto" class="sapUiTinyMarginEnd" visible="{/ui/showProject}">
              <Label id="lblProyecto" text="Definición del Proyecto" required="true" labelFor="inpProyecto" />
              <Input
                id="inpProyecto"
                value="{/filters/Proyecto}"
                placeholder="Seleccione uno o varios (separado por coma)"
                width="260px"
                showValueHelp="true"
                valueHelpRequest=".onValueHelpProyecto" />
            </VBox>

            <!-- TIPO DOC -->
            <VBox id="vbTipoDoc" class="sapUiTinyMarginEnd" visible="{/ui/showTipoDoc}">
              <Label id="lblTipoDoc" text="Tipo de documento" labelFor="inpTipoDoc" />
              <Input
                id="inpTipoDoc"
                value="{/filters/tipodoc}"
                placeholder="Seleccione uno o varios (ej: R, H)"
                width="200px"
                showValueHelp="true"
                valueHelpRequest=".onValueHelpTipoDoc" />
            </VBox>

            <!-- CECO -->
            <VBox id="vbCeco" class="sapUiTinyMarginEnd" visible="{/ui/showCeco}">
              <Label id="lblCeco" text="Grupo CECO" required="{/ui/showCeco}" labelFor="inpGrupoCeco" />
              <Input
                id="inpGrupoCeco"
                value="{/filters/Ceco}"
                placeholder="Seleccione uno o varios (separado por coma)"
                width="200px"
                showValueHelp="true"
                valueHelpRequest=".onValueHelpCeco" />
            </VBox>

            <!-- RANGO FECHAS -->
            <VBox id="vbFechas" class="sapUiTinyMarginEnd" visible="{/ui/showFechas}">
              <Label id="lblFechas" text="Rango de fechas de ejecución" required="true" labelFor="drsFechas" />
              <DateRangeSelection
                id="drsFechas"
                visible="{/ui/showFechas}"
                displayFormat="dd/MM/yyyy"
                valueFormat="yyyyMMdd"
                delimiter=" - "
                placeholder="Selecciona rango"
                change=".onFechaRangoChange"
                width="260px" />
            </VBox>

            <!-- ACCIÓN FILTRAR -->
            <VBox id="vbFiltrar" class="sapUiTinyMarginTop">
              <Button
                id="btnFiltrar"
                text="{i18n>filtrar}"
                type="Emphasized"
                icon="sap-icon://search"
                press=".onBuscar"
                enabled="{/ui/enableBuscar}" />
            </VBox>

          </HBox>

        </f:content>
      </f:DynamicPageHeader>
    </f:header>

    <!-- =========================
         CONTENT (tabla + toolbar superior)
         ========================= -->
    <f:content>
      <VBox
        id="vbContent"
        class="sapUiSmallMargin"
        busy="{/ui/busy}"
        busyIndicatorDelay="0">

        <!-- Toolbar principal -->
        <OverflowToolbar id="otAcciones">
          <Title
            id="ttlLista"
            text="{= 'Reembolsos encontrados (' + (${/list}.length || 0) + ')' }"
            level="H2" />
          <ToolbarSpacer id="_IDGenToolbarSpacer" />

          <ObjectStatus
            id="osConteoSel"
            text="{= 'Seleccionados: ' + (${/selectedCount} || 0) }"
            state="Information"
            visible="{/ui/sociedadSelected}" />

          <ToolbarSpacer id="_IDGenToolbarSpacer1" />

          <Button
            id="btnBuscarTop"
            text="Buscar"
            type="Emphasized"
            icon="sap-icon://search"
            press=".onBuscar"
            enabled="{/ui/enableBuscar}"
            visible="{/ui/sociedadSelected}" />



          <!-- PDF: ahora depende de selección (NO de /detail) -->
          <Button
            id="btnPdfTop"
            icon="sap-icon://pdf-attachment"
            text="{i18n>exportarPdf}"
            tooltip="{i18n>exportarPdf}"
            press=".onImprimirPdf"
            visible="{/ui/sociedadSelected}" 
            enabled="{= ${/selectedCount} > 0 &amp;&amp; !${/ui/isSociedad4813} }"
             />
             <Button
            id="btnSoporteIvaTop"
            icon="sap-icon://pdf-attachment"
            text="Soporte IVA"
            tooltip="Descargar Soporte IVA VIS"
            press=".onSoporteIvaPdf"
            enabled="{= ${/selectedCount} > 0 &amp;&amp; !${/ui/isSociedad4813} }"
            visible="{/ui/sociedadSelected}" />
 
          <!-- <Button
            id="btnSoporteOxaTop"
            icon="sap-icon://pdf-attachment"
            text="Soporte Oxa"
            tooltip="Descargar Soporte OXA"
            press=".onSoporteOxaPdf"
            enabled="{= ${/selectedCount} > 0 &amp;&amp; !${/ui/isSociedad4813} }"
            visible="{/ui/sociedadSelected}" />
            -->
            <Button
            text="{i18n>reembolsoDebito}"
            icon="sap-icon://pdf-attachment"
            press=".onExportPdf"
            enabled="{= ${/selectedCount} > 0 &amp;&amp; ${/ui/isSociedad4813} }" /> 

          <Button
            id="btnLimpiarTop"
            text="Limpiar"
            icon="sap-icon://clear-filter"
            type="Transparent"
            press=".onLimpiar"
            visible="{/ui/sociedadSelected}" />
        </OverflowToolbar>

        <!-- LISTA (selección + PDF desde selección) -->
        <Table
          id="tblLista"
          mode="MultiSelect"
          growing="true"
          growingScrollToLoad="true"
          sticky="ColumnHeaders,HeaderToolbar"
          selectionChange=".onSelectionChange"
          visible="{/ui/sociedadSelected}"
          items="{/list}">

          <headerToolbar>
            <Toolbar id="_IDGenToolbar">
              <Title id="_IDGenTitle" text="Listado" level="H3"/>
              <ToolbarSpacer id="_IDGenToolbarSpacer2"/>
              <Text id="_IDGenText" text="{= 'Total: ' + (${/list}.length || 0) + ' | Seleccionados: ' + (${/selectedCount} || 0) }"/>
            </Toolbar>
          </headerToolbar>

          <columns>
          <Column id="idSociedadColumn" width="8rem" visible="{/ui/isSociedad4813}" ><Text id="idSociedadText" text="{i18n>sociedad}" /></Column>
          <Column id="idGrupoCeCoColumn" width="8rem"  visible="{/ui/isSociedad4813}"><Text id="idGrupoCeCoText" text="{i18n>grupoCeCo}" /></Column>
          <Column id="idNombreGrupoCeCoColumn" width="8rem"  visible="{/ui/isSociedad4813}"><Text id="idNombreGrupoCeCoText" text="{i18n>nombreGrupoCeCo}" /></Column>
         

            <Column id="_IDGenColumn" width="10rem"><Text id="_IDGenText1" text="N° Reembolso" /></Column>
             <Column id="idCreadoPorColumn" width="8rem"  visible="{/ui/isSociedad4813}"><Text id="idCreadoPorText" text="{i18n>creadoPor}" /></Column>

            <Column id="_IDGenColumn1" width="10rem"><Text id="_IDGenText2" text="Fecha" /></Column>
            <Column id="_IDGenColumn2" width="8rem"><Text id="_IDGenText3" text="Hora" /></Column>
            <Column id="_IDGenColumn3" minScreenWidth="Tablet" demandPopin="true" visible="{/ui/showProject}"><Text id="_IDGenText4" text="Proyecto" /></Column>
          </columns>

          <items>
            <ColumnListItem id="_IDGenColumnListItem1" vAlign="Middle">
              <cells>

                <Text id="idCompanycodeText" text="{companycode}"/>
                <Text id="idGrupocecoText" text="{grupoceco}"/>
                <Text id="idNombreGrupocecoText" text="{nombreGrupoceco}"/>


                <ObjectIdentifier id="_IDGenObjectIdentifier" title="{numeroReembolso}" text="Reembolso" />
              
                <Text id="idAccountingdoccreatedbyuserText" text="{accountingdoccreatedbyuser}" />
                
                <Text id="_IDGenText5" text="{accountingdocumentcreationdate}" />
                <Text id="_IDGenText6" text="{creationtime}" />
                <Text id="_IDGenText7" text="{projectdescription}" />
              </cells>
            </ColumnListItem>
          </items>
        </Table>

      </VBox>
    </f:content>

  </f:DynamicPage>

</mvc:View>
